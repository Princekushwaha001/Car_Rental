{% extends "base.html" %}
{% load static %}
{% block header %}
{% include "partial/header.html" %}
{% endblock %}
{% block content %}

<div class="container my-5">

    <!-- Header -->
    <div class="text-center mb-4">
        <h2 class="font-weight-bold">My Bookings</h2>
        <p class="text-muted">Manage and track your reservations</p>
    </div>

    <!-- Filter Buttons -->
    <div class="text-center mb-4">
        <button class="btn btn-outline-dark btn-sm filter-btn active" data-filter="all">All</button>
        <button class="btn btn-outline-warning btn-sm filter-btn" data-filter="pending">Pending</button>
        <button class="btn btn-outline-success btn-sm filter-btn" data-filter="confirmed">Confirmed</button>
        <button class="btn btn-outline-danger btn-sm filter-btn" data-filter="cancelled">Cancelled</button>
    </div>

    {% if bookings %}
    <div class="row" id="booking-container">

        {% for booking in bookings %}
        <div class="col-md-6 col-lg-4 mb-4 booking-card" data-status="{{ booking.booking_status|lower }}">

            <div class="card shadow-sm border-0 h-100">

                <!-- Car Image -->
                {% if booking.car.image %}
                <img src="{{ booking.car.image.url }}" class="card-img-top" style="height:200px; object-fit:cover;">
                {% endif %}

                <div class="card-body">

                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            {{ booking.car }}
                        </h5>

                        {% if booking.booking_status == "confirmed" %}
                        <span class="badge badge-success">Confirmed</span>
                        {% elif booking.booking_status == "pending" %}
                        <span class="badge badge-warning">Pending</span>
                        {% elif booking.booking_status == "cancelled" %}
                        <span class="badge badge-danger">Cancelled</span>
                        {% else %}
                        <span class="badge badge-secondary">
                            {{ booking.booking_status }}
                        </span>
                        {% endif %}
                    </div>

                    <hr>

                    <p class="mb-1">
                        <strong>Start:</strong> {{ booking.start_date }}
                    </p>
                    <p class="mb-1">
                        <strong>End:</strong> {{ booking.end_date }}
                    </p>
                    <p class="mb-2">
                        <strong>Total:</strong>
                        <span class="text-success font-weight-bold">
                            â‚¹ {{ booking.total_amount }}
                        </span>
                    </p>

                    <a href="{% url 'booking-confirmation' booking.slug %}"
                        class="btn btn-outline-dark btn-sm btn-block mb-2">
                        View Details
                    </a>

                    {% if booking.booking_status == "pending" or booking.booking_status == "confirmed" %}
                    <a href="{% url 'cancel_booking' booking.pk %}" class="btn btn-outline-danger btn-sm btn-block">
                        Cancel Booking
                    </a>
                    {% endif %}

                </div>
            </div>
        </div>
        {% endfor %}

    </div>

    {% else %}
    <div class="text-center mt-5">
        <h4>No bookings yet ðŸš—</h4>
        <a href="{% url 'car-list' %}" class="btn btn-dark mt-3">
            Browse Cars
        </a>
    </div>
    {% endif %}

</div>


<!-- JS Filtering -->
<script>
    document.addEventListener("DOMContentLoaded", function () {

        const buttons = document.querySelectorAll(".filter-btn");
        const cards = document.querySelectorAll(".booking-card");

        buttons.forEach(btn => {
            btn.addEventListener("click", function () {

                // Remove active from all
                buttons.forEach(b => b.classList.remove("active"));
                this.classList.add("active");

                const filter = this.getAttribute("data-filter");

                cards.forEach(card => {
                    const status = card.getAttribute("data-status");

                    if (filter === "all" || status === filter) {
                        card.style.display = "block";
                    } else {
                        card.style.display = "none";
                    }
                });

            });
        });

    });
</script>


<style>
    .filter-btn.active {
        background-color: #343a40;
        color: white;
    }

    .booking-card {
        transition: all 0.3s ease;
    }

    .booking-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
</style>

{% endblock %}

{% block footer %}
        {% include "partial/footer.html" %}
{% endblock %}